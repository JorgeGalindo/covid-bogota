#Extracting, cleaning and producing a useful daily tracker of the health status of Colombia's daily COVID infections
#Author: Jorge Galindo

rm(list = ls())
library(tidyverse)
library(lubridate)

#1. Scrap and clean up a bit
individual_daily_df <- read.csv("Casos1.csv", sep =",", col.names=c("id", "detect_date","municipality","dept","status","age","sex","type","country_origin"))

individual_daily_df <- individual_daily_df %>% 
  mutate(detect_date=as.Date(detect_date,format="%d/%m/%Y"))


##Translate
individual_daily_df <- individual_daily_df  %>% 
  mutate(place=str_replace_all(status, c("Casa"="Home","Recuperado"="Recovered","Hospital UCI"="ICU", "Fallecido"="Dead")),
         status=str_replace_all(country_origin, c("Importado"="Imported","Relacionado"="Related", "En estudio"="Unknown"))
                )

#2. Produce a daily updated csv file storing the evolving status of all individual patients 

single_daily_df <- individual_daily_df %>%
  select(id, status) %>%
  mutate(status_date=today())


## Saving the output -- the append = TRUE part is crucial! Just edit the path.
write.table(single_daily_df, "data_output/cases_dailystatus.csv", sep = ",", append = TRUE, quote = FALSE,
            col.names = TRUE, row.names = FALSE)

#-------# If you run the script once daily up to here, you will get your CSV with daily updates. 
#-------# My advice: run it in the evening (Bogot√°/EST time). You may also want to consider automating the process with CRON.
